name: Test of dotnet setup task

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ ubuntu-latest ]

    steps:
      - uses: actions/checkout@v2
      
      - run: dotnet --info

      # - name: Set dotnet install dir (Ubuntu)
      #   if: runner.os == 'Linux'
      #   run: echo "DOTNET_INSTALL_DIR=/usr/share/dotnet" >> $GITHUB_ENV
      
      - name: Setup dotnet
        uses: actions/setup-dotnet@v1
        with:
          dotnet-version: 5.0.*

      - name: Setup dotnet
        uses: actions/setup-dotnet@v1
        with:
          dotnet-version: 3.1.*
          # source-url: https://api.nuget.org/v3/index.json
          source-url: https://nuget.pkg.github.com/vsafonkin/index.json
        env:
          NUGET_AUTH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - run: dotnet --info

      - name: Nuget.config
        shell: pwsh
        run: Get-Content '../nuget.config'

      - name: Create nuget package
        run: dotnet pack

      - name: Publish nuget package
        run: |
          dotnet nuget push bin/Debug/TestPackage.1.0.0.nupkg